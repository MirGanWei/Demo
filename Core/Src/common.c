
/* Includes ------------------------------------------------------------------*/
#include "common.h"

/* Global variable --------------------------------------------------------------*/

const uint16_t ccitt_table[256] = {
	0, 0xc1c0, 0x81c1, 0x4001, 0x1c3, 0xc003, 0x8002, 0x41c2, 0x1c6, 0xc006, 0x8007, 0x41c7, 5, 0xc1c5, 0x81c4, 0x4004,
	460, 0xc00c, 0x800d, 0x41cd, 15, 0xc1cf, 0x81ce, 0x400e, 10, 0xc1ca, 0x81cb, 0x400b, 0x1c9, 0xc009, 0x8008, 0x41c8,
	0x1d8, 0xc018, 0x8019, 0x41d9, 0x1b, 0xc1db, 0x81da, 0x401a, 30, 0xc1de, 0x81df, 0x401f, 0x1dd, 0xc01d, 0x801c, 0x41dc,
	20, 0xc1d4, 0x81d5, 0x4015, 0x1d7, 0xc017, 0x8016, 0x41d6, 0x1d2, 0xc012, 0x8013, 0x41d3, 0x11, 0xc1d1, 0x81d0, 0x4010,
	0x1f0, 0xc030, 0x8031, 0x41f1, 0x33, 0xc1f3, 0x81f2, 0x4032, 0x36, 0xc1f6, 0x81f7, 0x4037, 0x1f5, 0xc035, 0x8034, 0x41f4,
	60, 0xc1fc, 0x81fd, 0x403d, 0x1ff, 0xc03f, 0x803e, 0x41fe, 0x1fa, 0xc03a, 0x803b, 0x41fb, 0x39, 0xc1f9, 0x81f8, 0x4038,
	40, 0xc1e8, 0x81e9, 0x4029, 0x1eb, 0xc02b, 0x802a, 0x41ea, 0x1ee, 0xc02e, 0x802f, 0x41ef, 0x2d, 0xc1ed, 0x81ec, 0x402c,
	0x1e4, 0xc024, 0x8025, 0x41e5, 0x27, 0xc1e7, 0x81e6, 0x4026, 0x22, 0xc1e2, 0x81e3, 0x4023, 0x1e1, 0xc021, 0x8020, 0x41e0,
	0x1a0, 0xc060, 0x8061, 0x41a1, 0x63, 0xc1a3, 0x81a2, 0x4062, 0x66, 0xc1a6, 0x81a7, 0x4067, 0x1a5, 0xc065, 0x8064, 0x41a4,
	0x6c, 0xc1ac, 0x81ad, 0x406d, 0x1af, 0xc06f, 0x806e, 0x41ae, 0x1aa, 0xc06a, 0x806b, 0x41ab, 0x69, 0xc1a9, 0x81a8, 0x4068,
	120, 0xc1b8, 0x81b9, 0x4079, 0x1bb, 0xc07b, 0x807a, 0x41ba, 0x1be, 0xc07e, 0x807f, 0x41bf, 0x7d, 0xc1bd, 0x81bc, 0x407c,
	0x1b4, 0xc074, 0x8075, 0x41b5, 0x77, 0xc1b7, 0x81b6, 0x4076, 0x72, 0xc1b2, 0x81b3, 0x4073, 0x1b1, 0xc071, 0x8070, 0x41b0,
	80, 0xc190, 0x8191, 0x4051, 0x193, 0xc053, 0x8052, 0x4192, 0x196, 0xc056, 0x8057, 0x4197, 0x55, 0xc195, 0x8194, 0x4054,
	0x19c, 0xc05c, 0x805d, 0x419d, 0x5f, 0xc19f, 0x819e, 0x405e, 90, 0xc19a, 0x819b, 0x405b, 0x199, 0xc059, 0x8058, 0x4198,
	0x188, 0xc048, 0x8049, 0x4189, 0x4b, 0xc18b, 0x818a, 0x404a, 0x4e, 0xc18e, 0x818f, 0x404f, 0x18d, 0xc04d, 0x804c, 0x418c,
	0x44, 0xc184, 0x8185, 0x4045, 0x187, 0xc047, 0x8046, 0x4186, 0x182, 0xc042, 0x8043, 0x4183, 0x41, 0xc181, 0x8180, 0x4040
};

uint16_t crc_16(uint8_t *q, uint16_t len)
{
	uint16_t crc = 0xffff;

	while (len-- > 0)
	crc = ccitt_table[(crc >> 8 ^ *q++) & 0xff] ^ (crc << 8);
	
	return ((crc>>8)|(crc<<8));
}

const uint16_t crc_table[256] = {
	0x0000U, 0x1021U, 0x2042U, 0x3063U, 0x4084U, 0x50a5U, 0x60c6U, 0x70e7U,
	0x8108U, 0x9129U, 0xa14aU, 0xb16bU, 0xc18cU, 0xd1adU, 0xe1ceU, 0xf1efU,
	0x1231U, 0x0210U, 0x3273U, 0x2252U, 0x52b5U, 0x4294U, 0x72f7U, 0x62d6U,
	0x9339U, 0x8318U, 0xb37bU, 0xa35aU, 0xd3bdU, 0xc39cU, 0xf3ffU, 0xe3deU,
	0x2462U, 0x3443U, 0x0420U, 0x1401U, 0x64e6U, 0x74c7U, 0x44a4U, 0x5485U,
	0xa56aU, 0xb54bU, 0x8528U, 0x9509U, 0xe5eeU, 0xf5cfU, 0xc5acU, 0xd58dU,
	0x3653U, 0x2672U, 0x1611U, 0x0630U, 0x76d7U, 0x66f6U, 0x5695U, 0x46b4U,
	0xb75bU, 0xa77aU, 0x9719U, 0x8738U, 0xf7dfU, 0xe7feU, 0xd79dU, 0xc7bcU,
	0x48c4U, 0x58e5U, 0x6886U, 0x78a7U, 0x0840U, 0x1861U, 0x2802U, 0x3823U,
	0xc9ccU, 0xd9edU, 0xe98eU, 0xf9afU, 0x8948U, 0x9969U, 0xa90aU, 0xb92bU,
	0x5af5U, 0x4ad4U, 0x7ab7U, 0x6a96U, 0x1a71U, 0x0a50U, 0x3a33U, 0x2a12U,
	0xdbfdU, 0xcbdcU, 0xfbbfU, 0xeb9eU, 0x9b79U, 0x8b58U, 0xbb3bU, 0xab1aU,
	0x6ca6U, 0x7c87U, 0x4ce4U, 0x5cc5U, 0x2c22U, 0x3c03U, 0x0c60U, 0x1c41U,
	0xedaeU, 0xfd8fU, 0xcdecU, 0xddcdU, 0xad2aU, 0xbd0bU, 0x8d68U, 0x9d49U,
	0x7e97U, 0x6eb6U, 0x5ed5U, 0x4ef4U, 0x3e13U, 0x2e32U, 0x1e51U, 0x0e70U,
	0xff9fU, 0xefbeU, 0xdfddU, 0xcffcU, 0xbf1bU, 0xaf3aU, 0x9f59U, 0x8f78U,
	0x9188U, 0x81a9U, 0xb1caU, 0xa1ebU, 0xd10cU, 0xc12dU, 0xf14eU, 0xe16fU,
	0x1080U, 0x00a1U, 0x30c2U, 0x20e3U, 0x5004U, 0x4025U, 0x7046U, 0x6067U,
	0x83b9U, 0x9398U, 0xa3fbU, 0xb3daU, 0xc33dU, 0xd31cU, 0xe37fU, 0xf35eU,
	0x02b1U, 0x1290U, 0x22f3U, 0x32d2U, 0x4235U, 0x5214U, 0x6277U, 0x7256U,
	0xb5eaU, 0xa5cbU, 0x95a8U, 0x8589U, 0xf56eU, 0xe54fU, 0xd52cU, 0xc50dU,
	0x34e2U, 0x24c3U, 0x14a0U, 0x0481U, 0x7466U, 0x6447U, 0x5424U, 0x4405U,
	0xa7dbU, 0xb7faU, 0x8799U, 0x97b8U, 0xe75fU, 0xf77eU, 0xc71dU, 0xd73cU,
	0x26d3U, 0x36f2U, 0x0691U, 0x16b0U, 0x6657U, 0x7676U, 0x4615U, 0x5634U,
	0xd94cU, 0xc96dU, 0xf90eU, 0xe92fU, 0x99c8U, 0x89e9U, 0xb98aU, 0xa9abU,
	0x5844U, 0x4865U, 0x7806U, 0x6827U, 0x18c0U, 0x08e1U, 0x3882U, 0x28a3U,
	0xcb7dU, 0xdb5cU, 0xeb3fU, 0xfb1eU, 0x8bf9U, 0x9bd8U, 0xabbbU, 0xbb9aU,
	0x4a75U, 0x5a54U, 0x6a37U, 0x7a16U, 0x0af1U, 0x1ad0U, 0x2ab3U, 0x3a92U,
	0xfd2eU, 0xed0fU, 0xdd6cU, 0xcd4dU, 0xbdaaU, 0xad8bU, 0x9de8U, 0x8dc9U,
	0x7c26U, 0x6c07U, 0x5c64U, 0x4c45U, 0x3ca2U, 0x2c83U, 0x1ce0U, 0x0cc1U,
	0xef1fU, 0xff3eU, 0xcf5dU, 0xdf7cU, 0xaf9bU, 0xbfbaU, 0x8fd9U, 0x9ff8U,
	0x6e17U, 0x7e36U, 0x4e55U, 0x5e74U, 0x2e93U, 0x3eb2U, 0x0ed1U, 0x1ef0U
};

uint16_t crc_16_1021(uint16_t crc, uint8_t *data, uint32_t len)
{
	while (len--)
		crc = crc_table[(crc >> 8 ^ *(data++)) & 0xffU] ^ (crc << 8);
	return crc;
}

